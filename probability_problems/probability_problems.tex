\documentclass[a4paper,12pt]{article}
\usepackage[cp1251]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{bbm}


\newtheorem{theorem}{Теорема}[section]
\newtheorem{lemma}[theorem]{Лемма}
\newtheorem{proposition}[theorem]{Предложение}
\newtheorem{claim}[theorem]{Утверждение}
\newtheorem{corollary}[theorem]{Следствие}
\def\ci{\perp\!\!\!\perp}

%opening
\title{Вероятность --- задачи}
\author{}
\date{}


\begin{document}
\maketitle


\section{Kallenberg 2002 --- Глава 4}
\begin{enumerate}
 \item
 \item
 \item
\end{enumerate}

\section{Kallenberg 2002 --- Глава 5}
\begin{enumerate}
 \item
 \item
 \item
\end{enumerate}

\section{Kallenberg 2002 --- Глава 6. Условное матожидание}

Как доказать предложение 6.6 из Калленберга?
В первую сторону:
дано, что
$$P(H\mid \mathcal{F}, \mathcal{G})=P(H\mid \mathcal{G}), H \in \mathcal{H}$$
Покажем, что $$\mathcal{F}\amalg_{\mathcal{G}}\mathcal{H}.$$
Для этого надо показать, что при $F\in \mathcal{F}, H \in \mathcal{H}$
$$P^{\mathcal{G}}(F\cap H)=P^{\mathcal{G}}F \times P^{\mathcal{G}}H.$$
Иными словами,
$$\mathbb{E}(\mathrm{1}_{F\cap H}\mid \mathcal{G})=\mathbb{E}(\mathrm{1}_F\mid \mathcal{G}) \times \mathbb{E}(\mathrm{1}_H\mid \mathcal{G}).$$
Имеем
\begin{multline*}
 \mathbb{E}(\mathrm{1}_{F\cap H}\mid \mathcal{G})=\mathbb{E}(\mathrm{1}_F \mathrm{1}_H\mid \mathcal{G})=
 \mathbb{E}(\mathbb{E}(\mathrm{1}_F \mathrm{1}_H\mid \mathcal{F}, \mathcal{G})\mid \mathcal{G})=\\=
 \mathbb{E}(\mathrm{1}_F \mathbb{E}(\mathrm{1}_H\mid \mathcal{F}, \mathcal{G})\mid \mathcal{G})=
 \mathbb{E}(\mathrm{1}_F \mathbb{E}(\mathrm{1}_H\mid \mathcal{G})\mid \mathcal{G})=
 \mathbb{E}(\mathrm{1}_H \mid \mathcal{G})\times \mathbb{E}(\mathrm{1}_F \mid \mathcal{G}).
\end{multline*}

А в другую сторону?

\begin{enumerate}
 \item Пусть дано $(\xi, \eta)=^d(\xi', \eta)$. Покажем, что
 $$P(\xi\in B\mid \eta)=P(\xi' \in B \mid \eta).$$
 Из равенства по распределению следует, что для любых измеримых $A, B$
 $$P(\xi \in B, \eta \in A)=P(\xi' \in B, \eta \in A).$$
 Пусть
 $$\eta_1=\mathbb{E}(\mathbbm{1}_{\xi\in B}\mid \eta), \eta_2=\mathbb{E}(\mathbbm{1}_{\xi'\in B}\mid \eta).$$
 Тогда имеем
 \begin{multline*}
  \mathbbm{E}(\eta_1 \mathbbm{1}_{\eta\in A})=\mathbbm{E}(\mathbbm{1}_{\xi\in B}\mathbbm{1}_{\eta\in A})=P(\xi \in B, \eta \in A)=\\=
  P(\xi' \in B, \eta \in A)=\mathbbm{E}(\mathbbm{1}_{\xi'\in B}\mathbbm{1}_{\eta\in A})=\mathbbm{E}(\eta_2 \mathbbm{1}_{\eta\in A}).
 \end{multline*}
 Итак, $\eta_1$ и $\eta_2$ --- $F_\eta$-измеримые, причём интегралы от них по любому множеству из $F_\eta$ совпадают.
 Значит, они совпадают почти наверное. Получаем
 $$P(\xi\in B\mid \eta)=\eta_1=\eta_2=P(\xi' \in B \mid \eta) \enskip a.s.$$
 В другую сторону --- примерно так же. Сначала переписываем
 $$P(\xi\in B\mid \eta)=P(\xi' \in B \mid \eta)$$
 как $\eta_1=\eta_2 \enskip a.s.$ Интегрируя по множеству $\mathbbm{1}_{\eta\in A}$ из $F_\eta$, получаем
 $$P(\xi \in B, \eta \in A)=P(\xi' \in B, \eta \in A).$$
 А из этого равенства уже монотонным классом получаем равенство по распределению $(\xi, \eta)=^d(\xi', \eta)$.
 \item Если $\mathbb{E}^F\xi=\mathbb{E}^G\xi$ для любой $\xi\in L_1$, то покажем, что
 $\overline{F}=\overline{G}$. В эту сторону это несложно. Мы дляданного $A\in F$ воспользуемся
 тем, что
  $$\mathbb{E}^F\mathbbm{1}_A=1_A \enskip a.s.$$
  Значит,
  $$\mathbbm{E}^G1_A=1_A\enskip a.s.$$
  Но это значит, что множество $B\in G$ тех $\omega$, где $\mathbbm{E}^G1_A$ принимает значение 1,
  отличается от $A$ на множество меры 0:
  $$B=\{\omega\mid\mathbbm{E}^G1_A(\omega)=1\},$$
  $$P(A\triangle B)=0.$$
  Это значит, что любое $A\in F$ можно приблизить множеством из $G$ с точностью до множества меры 0.
  Но тогда любое $A\in \overline{F}$ тоже можно так приблизить множеством из $G$, и оно лежит в
  $\overline{G}$. Доказали.

  Теперь в другую сторону. Известно, что
  $$\overline{F}=\overline{G}.$$
  Достаточно доказать, что для любой $\xi\in L_1$
  $$\mathbb{E}^{\overline{F}}\xi=\mathbb{E}^F\xi \enskip a.s.$$
  Как это доказать? Пусть
  $$\eta=\mathbb{E}^F\xi.$$
  Надо показать, что $\eta$ может служить
  в роли $\mathbb{E}^{\overline{F}}\xi$. Для этого достаточно показать, что для любого множества
  $A\in \overline{F}$ выполнено
  $$\mathbb{E}(1_A\eta)=\mathbb{E}(1_A \xi).$$
  Но $A$ отличается от некоторого $B\in F$ на множество нулевой меры:
  $$P(A\triangle B)=0.$$
  Имеем, поскольку $B\in F$,
  $$\mathbb{E}(1_B \eta)=\mathbb{E}(1_B \xi).$$
  Но ясно, что
  $$\mathbb{E}(1_A \eta)=\mathbb{E}(1_B \eta),$$
  $$\mathbb{E}(1_A \xi)=\mathbb{E}(1_B \xi).$$
  Из этих равенств получаем
  $$\mathbb{E}(1_A \eta)=\mathbb{E}(1_A \xi),$$
  что и требовалось.
 \item Не хочу такое решать.
 \item Имеем
 $$\xi_n\wedge \eta\to \xi \wedge \eta \in L_1.$$
 Из свойства монотонной сходимости
 $$\sup_n\mathbb{E}^F\xi_n\ge\sup_n\mathbb{E}^F(\xi_n\wedge\eta)\ge
 \lim_{n}\mathbb{E}^F (\xi_n\wedge \eta) = \mathbb{E}^F(\xi\wedge \eta) = \mathbb{E}^F\eta.$$

 \item
 Пусть $\xi_n\uparrow \xi.$ Покажем, что для нового определения условного матожидания
 $$\mathbb{E}^F \xi_n \to \mathbb{E}^F\xi.$$
 Во-первых, заметим, что новое матожидание монотонно: если
 $$\xi \le \eta \enskip a.s.$$
 то
 $$\mathbb{E}^F \xi \le \mathbb{E}^F \eta \enskip a.s.$$
 Далее, пусть
 $$\xi_n \uparrow\xi \enskip a.s.$$
 Тогда
 $$\mathbb{E}^F\xi \ge \mathbb{E}^F \xi_n \enskip a.s.$$
 для любого $n$, а потому
 $$\mathbb{E}^F\xi \ge \lim_n \mathbb{E}^F \xi_n \enskip a.s.$$
 Осталось показать в обратную сторону:
 $$\mathbb{E}^F\xi \le \lim_n \mathbb{E}^F \xi_n \enskip a.s.$$
 Но это не так и сложно!
 Имеем
 $$\xi_m \wedge m \uparrow \xi,$$
 $$\eta=\xi\wedge n \le \xi,$$
 и мы находимся в условиях предыдущей задачи. Получаем из этой задачи
 $$\mathbb{E}^F (\xi\wedge n) \le \sup_m \mathbb{E}^F (\xi_m\wedge m)=
 \lim_m \mathbb{E}^F (\xi_m \wedge m) \enskip a.s.$$
 Однако
 $$\mathbb{E}^F \xi = \sup_n \mathbb{E}^F (\xi\wedge n).$$
 Значит,
 $$\mathbb{E}^F \xi \le \lim_m \mathbb{E}^F (\xi_m\wedge m) \le
 \lim_m \mathbb{E}^F \xi_m \enskip a.s.$$
 Это и требовалось.
 
 \item Потом. 
 \item Доказать: 
  $$\liminf_n \mathbb{E}^F \xi_n \ge \mathbb{E}^F \liminf_n \xi_n.$$
  Просто повторим доказательство леммы Фату. 
  Пусть 
  $$\eta_n=\inf_{m\ge n}\xi_m.$$
  Тогда 
  $$\eta_n \uparrow \liminf_n \xi_n.$$ 
  Но $\xi_n\ge \eta_n$, отсюда
  $$\liminf_n \mathbb{E}^F \xi_n \ge \liminf_n \mathbb{E}^F \eta_n = \lim_n \mathbb{E}^F \eta_n = 
  \mathbb{E}^F \lim_n \eta_n = \mathbb{E}^F \liminf_n \xi_n.
  $$
  Мы воспользовались свойством монотонной сходимости для
  таких условных матожиданий (задача 5). 
  \item Аналог теоремы Лебега об ограниченной сходимости --- 
  доказывается аналогично. 
  Пусть 
  $$\eta=\sup_n|\xi_n|.$$
  Имеем по предыдущей задаче
  $$\mathbb{E}^F\liminf_n(\eta-\xi_n)
  \le \liminf_n \mathbb{E}^F (\eta-\xi_n),$$
  $$\mathbb{E}^F \eta - \mathbb{E}^F \limsup_n \xi_n \le
  \mathbb{E}^F \eta - \limsup_n \mathbb{E}^F \xi_n,$$
  $$\limsup_n \mathbb{E}^F \xi_n \le 
  \mathbb{E}^F \limsup_n \xi_n.$$
  Аналогично, получаем
    $$\mathbb{E}^F\liminf_n(\eta+\xi_n)
  \le \liminf_n \mathbb{E}^F (\eta+\xi_n),$$
  $$\mathbb{E}^F \eta + \mathbb{E}^F \liminf_n \xi_n \le
  \mathbb{E}^F \eta + \liminf_n \mathbb{E}^F \xi_n,$$
  $$\liminf_n \mathbb{E}^F \xi_n \ge 
  \mathbb{E}^F \liminf_n \xi_n.$$
  Комбинируя, получаем
  $$\mathbb{E}^F \liminf_n \xi_n \le
  \liminf_n \mathbb{E}^F \xi_n \le
  \limsup_n \mathbb{E}^F \xi_n \le 
  \mathbb{E}^F \limsup_n \xi_n.$$
  Но 
  $$\mathbb{E}^F \liminf_n \xi_n =
  \mathbb{E}^F \lim_n \xi_n =
  \mathbb{E}^F \limsup_n \xi_n \enskip a.s.$$
  Отсюда получаем нужное соотношение. 
  \item Не будем решать, слишком известная задача. 
  \item Показать
  $$\mathbb{E}(\xi\mid F, 1_A)=\frac{\mathbb{E}(\xi;A\mid F)}{P(A\mid F)}$$
  почти наверное на $A$. 
  В этой задаче мне самым сложным было понять, что такое $\mathbb{E}(\xi;A\mid F)$. 
  Оказывается, это $\mathbb{E}(\xi 1_A\mid F).$ После того, как это понято, доказательство получается
  автоматически. 
   Итак, наш кандидат на роль условного матожидания
   $$
   \eta=\frac{\mathbbm{E}(\xi 1_A\mid F)}{P(A\mid F)}1_A+\frac{\mathbbm{E}(\xi 1_{A^c}\mid F)}{P(A^c\mid F)}1_{A^c}
   $$
   Ясно, что $\eta$ измерима относительно сигма-алгебры,
   порожденной $F$ и $A$. Остается только проверить, что
   для любого множества $B$ из этой сигма-алгебры
   $$\mathbbm{E}(\eta 1_B) = \mathbbm{E}(\xi 1_B).$$
   Достаточно проверить для множеств вида 
   $$U\cap A, U\cap A^c, U\in F.$$
   Проверим для множеств
   $$B=U\cap A, U\in F.$$
   Имеем
   \begin{multline*}
   	\mathbbm{E}\eta 1_B=
   	\mathbbm{E}\left(\frac{\mathbbm{E}(\xi 1_A\mid F)}{P(A\mid F)}1_A 1_U\right)=
   	\mathbbm{E} \mathbbm{E}\left(\frac{\mathbbm{E}(\xi 1_A\mid F)}{P(A\mid F)}1_A 1_U\mid F\right)=\\
   	= \mathbbm{E}\left(\frac{\mathbbm{E}(\xi 1_A\mid F)}{P(A\mid F)}1_U \mathbbm{E}(1_A\mid F)\right)=
   	\mathbbm{E}\left(\frac{\mathbbm{E}(\xi 1_A\mid F)}{P(A\mid F)}1_U P(A\mid F)\right)=\\=
   	\mathbbm{E}\left(\mathbbm{E}(\xi 1_A\mid F)1_U \right)=
   	\mathbb{E}\xi 1_A 1_U=\mathbb{E}\xi 1_B.
   \end{multline*}
   Здесь мы пользовались $F$-измеримостью множества $U$. 
   В общем, всё доказано. 
  \item Пусть $\eta_n=\mathbbm{E}(\xi_n \wedge 1 \mid F_n).$ 
  Тогда 
  $$\eta_n\xrightarrow[]{P}0.$$
  Отсюда и из $0 \le \eta_n \le 1$ следует
  $$\mathbbm{E}\eta_n \to 0, n \to \infty.$$
  Но $\mathbbm{E}\eta_n=\mathbbm{E}(\xi_n \wedge 1).$ Поэтому
  $$\mathbbm{E}(\xi_n \wedge 1)\to 0, n \to \infty.$$
  Но последнее соотношение и означает
  $$\xi_n \xrightarrow[]{P}0, n \to \infty.$$
  \item
  \item По условию, $(\xi, \eta)$ имеет плотность распределения $f(x,y)$,
  $$F(y)=\int f(x,y)dx, g(x,y)=f(x,y)/F(y).$$
  Покажем, что для фиксированного борелевского множества $B$ случайная величина
  $$H(\eta)=\int\limits_B g(x, \eta)dx$$
  годится на роль условного матожидания $P(\xi \in B \mid \eta).$ \
  Для этого надо проверить, что для любого борелевского множества $A$
  $$\mathbb{E} 1_{\eta \in A}  H(\eta)=P(\xi \in B, \eta \in A).$$
  Пусть
  $$G(y)=1_{y\in A}H(y),$$
  $$G(\eta)=1_{\eta\in A}H(\eta)=1_{\eta \in A} \int\limits_B g(x, \eta) dx.$$
  Нужно проверить: $$\mathbb{E} G(\eta)=P(\xi\in B, \eta\in A).$$
  Пусть $p_{\eta}$ --- плотность распределения $\eta$. Ясно, что $p_\eta=F$ (где по условию $F(y)=\int f(x,y)dx$).
  Имеем
  \begin{multline*}
   \mathbb{E} G(\eta)=\int\limits_{\mathbb{R}} G(y)p_{\eta}(y) dy =\int\limits_{\mathbb{R}}G(y)F(y)dy=\\=
   \int\limits_{\mathbb{R}}1_{y \in A} \left(\int\limits_B g(x,y)dx\right)F(y)dy=\\=
   \int\limits_A \left(\int\limits_B g(x,y)F(y)dx\right)dy=\int\limits_{A\times B}g(x,y)F(y)dxdy=\\=
   \int\limits_{A\times B}f(x,y)dxdy=P(\xi\in B, \eta \in A).
  \end{multline*}

  \item Теоремы о монотонной и ограниченной сходимости для условных матожиданий из соответствующих безусловных
  результатов с помощью условных распределений.
  Это хорошая задача! Дает прочувствовать условные матожидания.
  Пусть
  $$\xi_n\uparrow \xi_0, \xi_n \ge 0.$$
  В произведении пространств $\mathbb{R}^\infty$ множество последовательностей
  $$S=\{(x_0, x_1, x_2, x_3,\ldots)\mid x_{n}\le x_{n+1}, n \ge 1, \lim\limits_{n\to\infty}x_n=x_0\}$$
  является борелевским множеством.
  Рассмотрим бесконечномерный случайный вектор
  $$\zeta=(\xi_0, \xi_1, \xi_2, \ldots).$$
  Он принимает значения в борелевском пространстве $\mathbb{R}^\infty$. Поэтому существует регулярное условное распределение
  $$\nu(\omega, \cdot)=P(\zeta \in \cdot\mid \mathcal{F}).$$
  Из того, что $\zeta(\omega)$ лежит в $S$ с вероятностью 1, следует, что с вероятностью 1 мера $\nu(\omega)$ сосредоточена на $S$.
  И теперь можно применить теорему о монотонной сходимости к функциям \\ $y_1, \ldots, y_n, \ldots$ как координатным функциям от $y\in S$:
  \begin{multline*}
   \mathbb{E}(\xi_n \mid \mathcal{F})=\int\limits_{\mathbb{R}^\infty}y_n(y)\nu(\omega, dy)=\\=
   \int\limits_S y_n(y)\nu(\omega, dy)\to \int\limits_S y_0(y)\nu(\omega, dy)=\mathbb{E}(\xi_0 \mid \mathcal{F}).
  \end{multline*}
  Теорема об ограниченной сходимости получается аналогично, надо только заметить, что из интегрируемости мажоранты следует, что она интегрируема
  по мере $\nu(\omega)$ для почти всех $\omega$.
  \item $\mathbb{E}^{\mathcal{F}}\xi=^d \xi, \xi \in L_1$. Тогда $\xi$ почти наверное $\mathcal{F}$-измерима.
  Так и сделаем, как предлагает подсказка. Выберем строго выпуклую $f$, такую, что
  $$0 \le f(x)\le |x|, x\in \mathbb{R}.$$ Как это сделать? Выберем непрерывную функцию $h(x), x\ge 0$, которая монотонно строго возрастает на
  $\mathbb{R}_{+}$ и находится в пределах от $0$ до $1$ (например, сигмоида).
  Положим
  $$f(x)=\begin{cases}
   \int\limits_0^x h(y)dy, x > 0, \\
   0, x=0, \\
   f(-x), x < 0
  \end{cases}
  $$
  Ясно, что $f$ выпукла.


  Имеем по условию
  $$\mathbb{E}f(\xi)=\mathbb{E}f\left(\mathbb{E}^{\mathcal{F}}\xi\right).$$
  Но
  \begin{multline*}
   \mathbb{E}f(\xi)=\mathbb{E}\mathbb{E}\left(f(\xi)\mid \mathcal{F}\right)=\mathbb{E}\int\limits_{\mathbb{R}}f(x)\nu(\omega, dx)\ge \\ \ge
   \mathbb{E}f\left(\int\limits_{\mathbb{R}}x\nu(\omega, dx)\right)=\mathbb{E}f\left(\mathbb{E}^{\mathcal{F}}\xi \right).
  \end{multline*}
  Здесь неравенство написано по Иенсену, и раз оно обращается в равенство, то мера $\nu(\omega)$ почти наверное сосредоточена в одной (случайной)
  точке, причём эта точка есть $\int\limits_{\mathbb{R}}x\nu(\omega, dx)$.
  Отсюда получаем
  \begin{multline*}
   P\left(\xi=\mathbb{E}^{\mathcal{F}}\xi\right)=\mathbb{E}\mathbbm{1}_{\xi=\mathbb{E}^{\mathcal{F}}\xi}=
   \mathbb{E}\mathbb{E}\left(\mathbbm{1}_{\xi=\mathbb{E}^{\mathcal{F}}\xi}\mid \mathcal{F}\right)=\\=
   \mathbb{E}\int\limits_{\mathbb{R}}\mathbbm{1}_{x=\mathbb{E}^{\mathcal{F}}\xi}\nu(\omega, dx)=
   \mathbb{E}\int\limits_{\mathbb{R}}\mathbbm{1}_{x=\int\limits_{\mathbb{R}}x\nu(\omega, dx)}\nu(\omega, dx)=\\=
   \mathbb{E}\nu\left(\omega, \left\{\int\limits_{\mathbb{R}}x\nu(\omega, dx)\right\}\right)=1.
  \end{multline*}
 Здесь мы применили теорему 6.4, взяв в роли функции $f(x,y)$ $\mathbbm{1}_{x=y}$. в роли $\xi$ саму $\xi$, в роли $\eta$
 $\mathcal{F}$-измеримую случайную величину $\mathbb{E}^{\mathcal{F}}\xi$.

\item По задаче 12, имеем
$$P(\xi \in B \mid \eta) =^d P(\xi \in B \mid \zeta).$$
По задаче 15,
$$P(\xi \in B \mid \eta) = P(\xi \in B \mid \zeta) \enskip a.s.$$
По предложению 6.6, из выполняения для всех $B$ равенства
$$P(\xi \in B \mid \eta, \zeta) = P(\xi \in B \mid \eta) \enskip a.s.$$
следует, что $\xi \ci_{\eta} \zeta$.
\item
\item Дано: $\xi \ci_{\eta} \zeta$, $\gamma \ci (\xi, \eta, \zeta)$. Показать:
$$\xi \ci_{\eta, \gamma} \zeta, \xi \ci_{\eta} (\zeta, \gamma).$$
По предложению 6.6,
$$P(\xi \in A \mid \eta, \zeta)=P(\xi \in A \mid \eta).$$
Используя это и независимость $\gamma$ от $(\xi, \eta, \zeta)$, получаем
\begin{multline*}
 P(\xi \in A, \gamma \in B \mid \eta, \zeta)=\mathbb{E}(\mathbbm{1}_{\xi\in A, \gamma \in B} \mid \eta, \zeta)=\\=
 \mathbb{E}(\mathbb{E}(\mathbbm{1}_{\xi \in A}\mathbbm{1}_{\gamma\in B} \mid \eta, \xi, \zeta) \mid \eta, \zeta)=
 \mathbb{E}(\mathbbm{1}_{\xi \in A}\mathbb{E}(\mathbbm{1}_{\gamma \in B}\mid \eta, \xi, \zeta) \mid \eta, \zeta)=\\=
 \mathbb{E}(\mathbbm{1}_{\xi \in A} P(\gamma \in B)\mid \eta, \zeta)=P(\gamma \in B)P(\xi \in A\mid \eta, \zeta)=\\=
 P(\gamma \in B)P(\xi \in A \mid \eta).
\end{multline*}
Анадогично (вместо $\zeta$ --- единица) показываем, что
$$P(\xi \in A, \gamma \in B \mid \eta)=P(\gamma \in B)P(\xi \in A \mid \eta).$$
Из этих двух равенств получаем
$$P(\xi \in A, \gamma \in B \mid \eta, \zeta)=P(\xi \in A, \gamma \in B \mid \eta).$$
С помощью леммы о монотонном классе показываем, что для любого борелевского $H$
$$P((\xi, \gamma) \in H \mid \eta, \zeta)=P((\xi, \gamma)\in H \mid \eta).$$
По предложению 6.6, это означает, что
$$\xi, \gamma \ci_{\eta} \zeta.$$
По предложению 6.8, отсюда следует
$$\xi \ci_{\eta, \gamma}\zeta.$$

Но есть более короткий способ!
Имеем
$$P(\gamma\in A \mid \eta, \xi, \zeta)=P(\gamma \in A)=P(\gamma \in A \mid \eta, \zeta).$$
Отсюда по предложению 6.6 получаем
$$\gamma \ci_{\eta, \zeta} \xi.$$
С учётом $\xi \ci_{\eta} \zeta$ получаем отсюда по предожению 6.8
$$\xi \ci_{\eta} \zeta, \gamma.$$
А отюда по предложению 6.8 получаем и
$$\xi \ci_{\eta, \gamma} \zeta.$$
Всё доказано.
Кстати,
$$\gamma \ci_{\eta, \zeta} \xi$$
можно получить проще с помощью предложения 6.8.
Имеем
$$\gamma \ci \xi, \eta, \zeta,$$
$$\gamma \ci_{1} \xi, \eta, \zeta,$$
$$\gamma \ci_{1, \eta, \zeta} \xi,$$
$$\gamma \ci_{\eta, \zeta} \xi.$$
Ведь условная независимость --- частный случай обычной!

\item
\item $\eta=P(\xi \in \cdot \mid F).$ Я понимаю это так, что $\eta$ --- это совокупность случайных элементов
$$P(\xi \in B \mid F)$$
для всевозможных борелевских $B$. Надо показать, что $\xi \ci_{\eta} F$.
Это проще, чем кажется! По предложению 6.6, достаточно показать, что
$$P(H \mid F, \sigma(\eta))=P(H\mid \sigma(\eta))$$
для всех $H\in \sigma(\xi))$. Но все такие $H$ имеют вид $\mathbbm{1}_{\xi \in A}$ для борелевскиих $A$.
Итак, достаточно показать, что
$$P(\xi \in A \mid F, \sigma(\eta))=P(\xi \in A \mid \sigma(\eta)).$$
Но $\sigma(\eta)\subseteq F$.  Поэтому надо показать, что
$$P(\xi \in A \mid F)=P(\xi \in A \mid \sigma(\eta)).$$
Но матожидание можно брать сначала по более широкой, потом по более узкой сигма-алгебре, и
$$P(\xi \in A \mid \sigma(\eta))=\mathbb{E}(P(\xi\in A\mid F)\mid \sigma(\eta))=P(\xi \in A \mid F),$$
ибо $P(\xi \in A \mid F)$ измерима относительно $\sigma(\eta)$. Всё доказано.

\item Воспользуемся указанием. В указании приведено полное решение, но надо дописать комментарии --- ссылки на теоремы.

Первый шаг: существуют $f$ и $\theta$ со свойством
$$(f(\eta, \theta), \eta)=^d (\xi, \eta).$$
Это получается применением теоремы 6.10 (трансфер) к $\xi$ и $\eta=^d \eta$.

Второй шаг: существует случайный вектор $(\gamma, \tilde{\eta})=^d (\theta, \eta)$ со свойством
$$(\xi, \eta)=(f(\tilde{\eta}, \gamma), \tilde{\eta}) \enskip a.s.$$
Это получается применением следствия 6.11 (стохастические уравнения) к случайным элементам
$(\xi, \eta)$ и $(\eta, \theta)$, связанным соотношением
$$(\xi, \eta)=^d g(\eta, \theta).$$
Здесь $g(x, y)=(f(x,y), x)$. По 6.11 как раз и получаем существование случайного вектора
$(\tilde{\eta}, \gamma)=^d(\eta, \theta)$ со свойством
$$(\xi, \eta)=g(\tilde{\eta}, \gamma) \enskip a.s.$$
Осталось понять, почему $\gamma$ не завиит от $\eta$. \\
Да потому что $\eta=\tilde{\eta} \enskip a.s.$,
а $\gamma$ не зависит от $\tilde{\eta}$ в силу $(\gamma, \tilde{\eta})=^d (\theta, \eta)$. Вот и всё.

\item А эта задача легко получается из предыдущей. По предыдущей задаче, существуют борелевская функция $f$
и случайная величина $\gamma \ci \xi$ с распределением $U(0, 1)$, такие, что
$$\eta=f(\xi, \gamma) \enskip a.s.$$
Выберем случайную величину $\theta \ci (\xi, \gamma)$ с распределением $U(0, 1)$. Тогда
$$\tilde{\eta}=f(\xi, \theta)$$
есть искомый случайный элемент. Соотношение
$$\tilde{\eta}\ci_{\xi} \eta$$
выполняется по предложению 6.13. Ведь $\tilde{\eta}=f(\xi, \theta)$ и $\theta \ci (\xi, \eta)$.
\end{enumerate}


\section{Kallenberg 2002 --- Глава 7. Мартингалы}
\begin{enumerate}
 \item $\{\sigma=\tau\} \in F_{\sigma}\cap F_{\tau}.$ Достаточно показать, что
 $$\{\sigma < \tau\} \in F_{\sigma} \cap F_{\tau}.$$
 Отсюда с учётом аналогичного влючения для $\{\tau < \sigma\}$ будет следовать, что
 $$\{\sigma \ne \tau\} \in F_{\sigma} \cap F_{\tau}.$$
 Итак, имеем
 $$\{\sigma < \tau\} \cap \{\tau \le t\}=\mathop{\cup}\limits_{0<q<t, q \in \mathbb{Q}}\left(\{\sigma< q\}\cap\{q<\tau \le t\}\right)\in F_t.$$
 Это верно для любого $t$, и по определению $F_{\tau}$ получаем
 $$\{\sigma < \tau\} \in F_{\tau}.$$
 Далее,
 $$\{\sigma < \tau\} \cap \{\sigma \le t\}=\{\sigma < \tau, \tau \le t\} \cup \{\sigma \le t, \tau > t\}.$$
 Но оба последних события лежат в $F_t$. Дейтвительно,
 $$\{\sigma < \tau, \tau \le t\}\in F_t$$
 мы доказали выше, а
 $$\{\sigma \le t, \tau > t\}=\{\sigma \le t\} \cap \{\tau > t\} \in F_t.$$
 Итак,
 $$\{\sigma < \tau\} \cap \{\sigma \le t\} \in F_t$$
 для любого $t$, и по определению $F_{\sigma}$ получаем $\{\sigma < \tau\}\in F_{\sigma}.$

 Далее, почему $F_{\sigma}= F_{\tau}$ на $\{\sigma=\tau\}$? Пусть $A\subseteq \{\sigma=\tau\}, A \in F_{\sigma}.$
 Покажем, что $A\in F_{\tau}.$ Из $A \in F_{\sigma}$ следует, что для любого $t$
 $$A\cap \{\sigma \le t\} \in F_t.$$
 Поскольку на множестве $A$ $\sigma=\tau$, то для любого $t$
  $$A\cap \{\tau \le t\} = A\cap \{\sigma \le t\}\in F_t.$$
По определению $F_\tau$, $A \in F_\tau$. Вот и доказали всё.

Осталось объяснить, почему $F_\tau$ может отличаться от $F_\infty$ на $\{\tau=\infty\}$. Это ясно. Если $\tau=\infty$ всегда, то по определению
$F_\tau$, в $F_{\tau}$ входят все множества из сигма-алгебры $A$, а не только из $F_\infty$.
 \item Стандартная задача.
 \item Пример слабо опционального, но не опционального момента. Возьмём, как предлагает Калленберг.
 Берём бернуллиевскую случайную величину $\xi, P(\xi=1)=P(\xi=-1)=\frac12$, и положим
 $$F_0=\{\emptyset, \Omega\}, F_t=\sigma(\xi), t >0.$$
 Пусть
 $$\tau=\begin{cases}
        0, \xi =-1, \\
        1, \xi = 1.
       \end{cases}
        $$
Тогда для $t>0$ имеем
$$\{\tau<t\}=\begin{cases}
              \{\xi = -1\}, t \le 1, \\
              \Omega, t > 1.
             \end{cases}
$$
В любом случае, $\{\tau<t\} \in F_t=\sigma(\xi), t>0$. Поэтому $\tau$ слабо опциональный.
Но $\{\tau \le 0\}=\{\tau=0\}=\{\xi = -1\}\notin F_0.$ Поэтому $\tau$ не опциональный.


\item Скучно решать это.

\item Задача про прогрессивные процессы. Прогрессивность --- это измеримость относительно соответствующей сигма-алгебры.
Итак, сначала покажем, что класс множеств $A\in \Omega \times \mathbb{R}_+$, таких, что процесс $1_A$ прогрессивен, образует сигма-алгебру.
Да это вроде очевидно! Прогрессивность $1_A$ означает, что для любого $t$
$$A \cap \left(\Omega \times [0, t]\right) \in F_t \otimes \mathcal{B} [0, t].$$
Ясно, что это свойство сохраняется счётным объединением. И для перехода к дополнению всё тоже очевидно. Итак, да, сигма-алгебра.

Почему прогрессивность процесса равносильна его измеримости \\ относительно  этой сигма-алгебры? Допустим, процесс $X$ прогрессивен. Покажем,
что он измерим относительно этой сигма-алгебры. Нужно проверить, что для любого $a$ множество $\{X>a\}$ лежит в прогрессивной сигма-алгебре.
А оно там лежит, если для любого $t$
$$\{X > a\}\cap \left(\Omega \times [0, t]\right) \in F_t \otimes \mathcal{B} [0, t].$$
А это так, если $X$ прогрессивен. И в другую сторону аналогично. Короче, пусть Калленберг сам решает такие задачи! Одни проверки.

\setcounter{enumi}{8}
\item $X^1, X^2, \ldots$ --- субмартингалы, причём $X=\sup_n X^n$ интегрируем. Покажем, что $X$ --- тоже субмартингал. Фиксируем $t>s$.
Имеем
$$\forall n \enskip X(t) \ge X_n(t),$$
$$\forall n \enskip  \mathbb{E}(X(t)\mid F_s) \ge \mathbb{E}(X_n(t) \mid F_s) \ge X_n(s), $$
а поскольку это для любого $n$, то
$$\mathbb{E}(X(t)\mid F_s) \ge \sup_n X_n(s)=X(s).$$
Вот и доказали.
Дальше сложнее. Покажем, что если $\sup_n |X_n|$ интегрируем, то и $\lim \sup_n X_n$ --- субмартингал. Фиксируем $s<t$. Пусть
$$\xi_n=\sup(X_n(t),  X_{n+1}(t), X_{n+2}(t), \ldots),$$
$$\eta_n=\sup(X_n(s),  X_{n+1}(s), X_{n+2}(s), \ldots).$$
Пусть также $\xi=\sup_n|X_n(t)|, \eta=\lim\sup_n X_n(s)$. Имеем
$$\lim_{n\to\infty}\xi_n=\lim \sup_n X_n(t)\enskip a.s., |\xi_n| \le \xi \enskip a.s..$$
По условию, $\xi$ интегрируема. Значит, по теореме Лебега об ограниченной сходимости,
$$\xi_n\xrightarrow[n\to\infty]{L_1}\lim \sup_n X_n(t).$$
Условное матожидание при условии $F_s$ --- ограниченный оператор на $L_1(F_t)$, см. начало предыдущей главы. Поэтому
$$\zeta_n=\mathbb{E}(\xi_n \mid F_s) \xrightarrow[n\to\infty]{L_1} \mathbb{E}(\lim \sup_n X_n(t) \mid F_s)=\zeta.$$
Из условия субмаритингальности,
$$\eta_n \le \mathbb{E}(\xi_n \mid F_s)=\zeta_n.$$
Но аналогичные рассуждения для момента $s$
$$\eta_n\xrightarrow[n\to\infty]{L_1}\lim \sup_n X_n(s)=\eta.$$
Итак, имеем две последовательности случайных величин $\zeta_n \ge \eta_n$, и обе сходятся в $L_1$:
$$\zeta_n\xrightarrow[n\to\infty]{L_1}\zeta, \eta_n\xrightarrow[n\to\infty]{L_1}\eta.$$
Покажем, что
$$\zeta \ge \eta \enskip a.s.$$
Действительно,
$$\zeta_n-\eta_n \ge 0, \zeta_n-\eta_n\xrightarrow[n\to\infty]{L_1}\zeta-\eta.$$
Но $L_1$-предел неотрицательных случайных величин неотрицателен почти наверное. Действительно, если $\lambda_n$ --- неотрицательные случайные величины
и
$$\lambda_n\xrightarrow[n\to\infty]{L_1}\lambda,$$
$$A=\{\omega\in \Omega \mid \lambda(\omega)<0\},$$
то при $P(A)>0$ имеем $\mathbb{E}\lambda_n\mathbbm{1}_A\to \mathbb{E}\lambda\mathbbm{1}_A < 0$, противоречие.
Кстати, откуда следует сходимость
$\mathbb{E}\lambda_n\mathbbm{1}_A\to \mathbb{E}\lambda\mathbbm{1}_A, n\to\infty$? \\
Эта сходимость следует из
$$|\mathbb{E}\lambda_n\mathbbm{1}_A-\mathbb{E}\lambda\mathbbm{1}_A|\le \mathbbm{E}|(\lambda_n-\lambda)\mathbbm{1}_A| \le
\mathbbm{E}|\lambda_n-\lambda|\to 0, n \to\infty.$$
Вот всё и доказали. Неравенство $\zeta \ge \eta \enskip a.s.$ и есть нужное нам неравенство
$$\mathbb{E}(\lim \sup_n X_n(t) \mid F_s) \ge \lim \sup_n X_n(s),$$
показывающее субмартингальность процесса $\lim \sup_n X_n$.
\item Разложение Дуба интегрируемой случайной последовательности $X=(X_n)$ зависит от фильтрации. Возьмём
$$F_n=\sigma(X_0, X_1, \ldots, X_n), G_n=\sigma(X_0, X_1, \ldots, X_n, X_{n+1})=F_{n+1}.$$
Тогда $X$ согласован и с фильтрацией $F_n$, и с фильтрацией $G_n$. Относительно фильтрации $G_n$ $X$ является предсказуемой \\
последовательностью, и разложение Дуба имеет вид
$$X_n=X_0+(X_n-X_0).$$
Когда у $X$ относительно фильтрации $F_n$ такое же разложение Дуба? Если оно то же, то $X_n-X_0$ должно быть при каждом $n \ge 1$
$F_{n-1}$-измеримым. Тогда и $X_n$ при каждом $n\ge 1$ $F_{n-1}$-измеримо. Но тогда при каждом $n \ge 1$
$$\sigma(X_0, X_1, \ldots, X_{n-1})=\sigma(X_0, X_1, \ldots, X_n),$$
$$F_{n-1}=F_n.$$
Тогда все сигма-алгебры $F_n$ совпадают, и при каждом $n$ $X_n$ является $X_0$-измеримой величиной.

\item
\item
\item
\item Доказательство леммы 4.15 дословно переносится на случай, когда $\xi_n$ --- мартингал-разность для $L_2$-интегрируемого мартингала $M$.
Итак, для $L_2$-ограниченного мартингала имеет место неравенство Колмогорова
$$P(\sup_n |M_n| > r)\le r^{-2} \sup_n\mathbb{E} M_n^2.$$
Но можно такое вывести и из леммы 7.15. Эта лемма даёт для субмартингала $X$
$$rP(\sup_t |X_t| \ge r) \le 3 \sup_t \mathbb{E} |X_t|.$$
Мы можем взять в качестве $X$ субмартингал $M^2$ (квадрат мартингала --- субмартингал). Имеем тогда из этого неравенства
$$r^2P(\sup_n |M_n| \ge r)=r^2 P(\sup_n X_n \ge r^2) \le 3 \sup_n \mathbb{E} |X_n|=3 \sup_n \mathbb{E} M_n^2.$$

А теперь мы можем имитировать доказательство леммы 4.16. Пусть $n$ фиксировано, построим случайный процесс $X^{(n)}$ на $\mathbb{Z}_+$,
$$X^{(n)}_k = (M_{n+k}-M_n)^2, k \ge 0.$$
Тогда $X^{(n)}$ --- субмартингал. Имеем для него из 7.15
\begin{multline*}
 P(\sup_{k\ge 0}X^{(n)}_k \ge \epsilon^2)\le 3 \epsilon^{-2}\sup_{k\ge 0}\mathbb{E}|X^{(n)}_k| = 3 \epsilon^{-2}\mathbb{E}(M_{n+k}-M_n)^2 \le \\ \le
3 \epsilon^{-2}\sum\limits_{k \ge 0} \mathbb{E}(M_{n+k+1}-M_{n+k})^2\to 0, n \to \infty.
\end{multline*}

Отсюда
$$P(\sup_{k\ge 0}(M_{n+k}-M_n)^2 > \epsilon^2)\to 0, n \to \infty$$
для любого $\epsilon>0.$ Итак,
$$\sup_{k\ge n} |M_k-M_n|\xrightarrow[n\to\infty]{P}0.$$
Значит, для некоторой подпоследовательности $n_s$
$$\sup_{k\ge n_s} |M_k-M_{n_s}|\xrightarrow[s\to\infty]{a.s.}0.$$
Но если $\sup_{k\ge n_s} |M_k-M_{n_s}| \le \epsilon$, то
$$\sup_{k_1, k_2\ge n_s} |M_{k_1}-M_{k_2}| \le 2\epsilon.$$
Отсюда следует, что последовательность $\{M_n\}$ фундаментальна почти наверное. Значит, сходится почти наверное. Ну а сходимость в $L_2$
по сравнению с этим тривиальна и следует из фундаментальности в $L_2$ последовательности $M_n$:
$$\sup_{k\ge 0}\mathbb{E}(M_{n+k}-M_n)^2 \le \sum\limits_{k \ge 0} \mathbb{E}(M_{n+k+1}-M_{n+k})^2\to 0, n \to \infty.$$

\item Мартингал, который $L^1$-ограничен, но не равномерно интегрируем. Это известный пример. Берём последовательность независимых случайных
величин $\xi_n$, каждая из которых принимает значения 0 и 2 с равными вероятностями $\frac12$. Пусть
$$X_n=\xi_1\xi_2\ldots\xi_n.$$
Тогда $\mathbb{E}|X_n|=\mathbb{E}X_n=1$, но $X_n$ не равномерно интегрируем.
А в непрерывном времени пример? Это экспоненциальные мартингалы.
$$X_t=e^{w_t-t/2}.$$
Ясно, что $\mathbb{E}X_t=\mathbb{E}X_0=1.$ Почему $X_t$ не равномерно интегрируем? Потому что
$$X_t\xrightarrow[t\to\infty]{a.s.}0.$$
Если бы $X_t$ был равномерно интегрируем, то сходимость к 0 была бы и в $L^1$, а её нет, потому что
$$\mathbb{E}X_t=1 \ne 0.$$

\item Это просто. Фиксируем $G\in \mathcal{G}, H\in \mathcal{H}$. Имеем
$$P(G\cap H \mid \mathcal{F}_n)=P(G \mid \mathcal{F}_n)P(H \mid \mathcal{F}_n) \enskip a.s.$$
Оказывается, обе части этого равенства сходятся почти наверное при $n\to\infty.$
Действительно, из теоремы 7.23 имеем сходимость
$$P(G\mid \mathcal{F}_n)\to P(G\mid \mathcal{F}_\infty) \enskip a.s.,$$
$$P(H\mid \mathcal{F}_n)\to P(H\mid \mathcal{F}_\infty) \enskip a.s.,$$
$$P(G\cap H \mid \mathcal{F}_n)\to P(G\cap H\mid \mathcal{F}_\infty) \enskip a.s.$$
Отсюда всё получается, просто переходим к пределу в обеих частях равенства
$$P(G\cap H \mid \mathcal{F}_n)=P(G \mid \mathcal{F}_n)P(H \mid \mathcal{F}_n) \enskip a.s.$$
\end{enumerate}


\section{Kallenberg 2002 --- Глава 12}
\begin{enumerate}
 \item
 \item
 \item
\end{enumerate}

\section{Protter --- Глава 2}
\begin{enumerate}
 \item $f\colon \mathbb{R}\to \mathbb{R}$ непрерывна за исключением одной точки, в которой у неё скачок. Показать, что $X_t=f(B_t)$ не семимартингал.

 Решение задачи опирается на то, что в окрестности момента достижения любого уровня броуновское движение бесконечно много раз проходит через этот уровень.

 Фиксируем $t>0$ и покажем, что $X^t$ --- не тотальный семимартингал.
 Пусть $a$ --- точка скачка $f$.
 Пусть
 $$\tau_a=\inf\{t>0 \colon B_t=a\}.$$
 Для $\epsilon>0$ определим последовательность моментов остановки $\tau^{\epsilon}_n$ следующим образом:
 $$\tau^{\epsilon}_0=\inf\{t>0 \colon B_t=a-\epsilon\},$$
 $$\tau^{\epsilon}_{2n+1}=\inf\{t>\tau^{\epsilon}_{2n} \colon B_t=a+\epsilon\},$$
 $$\tau^{\epsilon}_{2n}=\inf\{t>\tau^{\epsilon}_{2n-1} \colon B_t=a-\epsilon\}.$$
Из свойств броуновского движения
$$\max\{n > 0 \colon \tau^{1/m}_n<t\} \xrightarrow[m \to \infty]{a.s.} \infty$$
на множестве $\{\tau_a<t\}$.
Пусть $h_m\to\infty$ такая детерминированная последовательность, что
$$0<h_m < \sqrt{m}$$
и
$$P(\max\{n > 0 \colon \tau^{1/m}_n<t\}>h_m)\ge \frac12 P\{\tau_a<t\}.$$

 Определим случайные процессы $H_m$ таким образом:
 $$H_m(t)=\begin{cases}
                      0, t \le \tau^{1/\sqrt[3]{h_m}}_0, \\
                      \frac{(-1)^n}{\sqrt{h_m}}, t \in (\tau^{1/\sqrt[3]{h_m}}_n, \tau^{1/\sqrt[3]{h_m}}_{n+1}], n < m, \\
                      0, t > \tau^{1/\sqrt[3]{h_m}}_{m}
                     \end{cases}
.$$
Тогда
$$|I_{X^t}(H_m)| \ge \frac{1}{h_m^{5/6}} \left(m \wedge \max\{n > 0 \colon \tau^{1/m}_n<t\}\right)-
\frac{1}{\sqrt{h_m}}|\sup\limits_{s\in [0,t]}f(B_s)-\inf\limits_{s\in [0,t]}f(B_s)|.$$
С вероятностью не меньше, чем $\frac12 P\{\tau_a<t\}=const>0$ имеем
$$\max\{n > 0 \colon \tau^{1/m}_n<t\}>h_m,$$
$$|I_{X^t}(H_m)|>h_m^{1/6}-\frac{1}{\sqrt{h_m}}|\sup\limits_{s\in [0,t]}f(B_s)-\inf\limits_{s\in [0,t]}f(B_s)| \xrightarrow[m \to\infty]{a.s.} \infty.$$
Это противоречит сходимости по вероятности $$I_{X^t}(H_m)\xrightarrow[m\to\infty]{P}0.$$
Значит, $X^t$ --- не тотальный семимартингал, а $X$ --- не семимартингал.

 \item
 \item
\end{enumerate}

\section{Revuz-Yor --- Глава 2. Мартингалы}
1.20.
$$P\left(\limsup_{h\to 0} \frac{|B_{s+h}-B_s|}{\sqrt{2h\log_2{1/h}}}=1\enskip \mbox{for}\enskip \mu-a.e. \enskip s \right)=1.$$
Рассмотрим случайную величину $\tau\ge 0$, не зависящую от $B$, с распределением $\mu$:
$$P(\tau\le a)=\mu([0, a]), a\ge 0.$$
Тогда, как легко видеть,
$$\xi(h)=B(\tau+h)-B(\tau), h \ge 0$$
есть винеровский процесс.
Как это увидеть? Если не напрямую, то можно воспользоваться строго марковским свойством
винеровского процесса. Для этого надо фильтрации $F_t$ расширить с помощью сигма-алгебры,
порождённой моментом $\tau$. Винеровский процесс $B$ останется винеровским и относительно расширенной
фильтрации. А $\tau$ станет моментом остановки относительно новой фильтрации. Останется применить
строго марковское свойство.
Теперь осталось применить к процессу $\xi$ теорему 1.9 (закон повторного логарифма).
\end{document}
